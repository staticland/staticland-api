#!/usr/bin/env node

var exit = require('exit')

var config = require('../config')
var createAdminAccount = require('../lib/create-admin-account')
var dirs = require('../lib/site-directories')(config)
dirs.init()

var email = process.argv[2]
var password = process.argv[3]
var requiredScopes = config.requiredScopes

if (!email) {
  error('email is required', { usage: true })
}

if (!password) {
  error('password is required', { usage: true })
}

var creds = {
  basic: {
    email: email,
    password: password
  }
}

createAdminAccount(config, creds, function (err, account) {
  if (err) return error(err.message)
  console.log('account created')
  console.log('key', account.key)
  console.log('email', account.auth.basic.email)
  console.log('scopes', account.access.scopes)
  console.log('token', account.token)
})

function error (msg, opts) {
  console.log(`
    ERROR:

      ${msg}
  `)
  if (opts.usage) usage()
  exit(1)
}

function usage () {
  console.log(`
    USAGE:

      ./bin/admin {email} {password}

    DESCRIPTION:

      create an account with the required
      access permissions to use the server

      email and password are required

    EXAMPLE:

      ./bin/admin hi@static.land oooohsecretpasswordoooh
`)
}
